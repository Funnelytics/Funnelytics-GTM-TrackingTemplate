___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.


___INFO___

{
  "displayName": "Funnelytics",
  "categories": ["ANALYTICS", "CONVERSIONS"],
  "description": "Deploy the Funnelytics tracking script or track user actions on your website using the Funnelytics-hosted deployment.",
  "securityGroups": [],
  "id": "cvt_temp_public_id",
  "type": "TAG",
  "version": 1,
  "brand": {
    "thumbnail": "data:image/png;base64,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\u003d\u003d",
    "displayName": "",
    "id": "brand_dummy"
  },
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "help": "This tag can be used to install the \u003cstrong\u003eProject Tracking Script\u003c/strong\u003e or to \u003cstrong\u003eTrack a User Action\u003c/strong\u003e in Funnelytics. \u003cbr\u003e\u003cbr\u003e\n\nIn order to track a user action, you must have created a \u003cstrong\u003eBase Tracking Script Tag\u003c/strong\u003e  to fire on all pages, and ensure it fires before the action script using \u003ci\u003eTag Sequencing\u003c/i\u003e",
    "displayName": "Choose Tag Type",
    "simpleValueType": true,
    "name": "baseScript",
    "type": "RADIO",
    "radioItems": [
      {
        "displayValue": "Base Tracking Script",
        "value": "baseScript"
      },
      {
        "displayValue": "Track a User Action",
        "value": "action"
      }
    ]
  },
  {
    "help": "Find your Project ID in Funnelytics by clicking on the Project of interest and copying the unqiue ID string from the URL. It should look like this \u003cstrong\u003e\u0027b915c971-76c8-491f-8923-6bdf5ccea523\u0027\u003c/strong\u003e.",
    "valueValidators": [
      {
        "args": [
          "^[A-Fa-f0-9]{8}-[A-Fa-f0-9]{4}-[A-Fa-f0-9]{4}-[A-Fa-f0-9]{4}-[A-Fa-f0-9]{12}$"
        ],
        "errorMessage": "This project ID is invalid. It should be an alphaneumeric string in the following format \u0027b915c971-76c8-491f-8923-6bdf5ccea523\u0027",
        "type": "REGEX"
      }
    ],
    "displayName": "Project ID",
    "simpleValueType": true,
    "name": "projectId",
    "type": "TEXT",
    "valueHint": "ex. b915c971-76c8-491f-8923-6bdf5ccea5e3",
    "enablingConditions": [
      {
        "paramName": "baseScript",
        "paramValue": "baseScript",
        "type": "EQUALS"
      }
    ]
  },
  {
    "help": "Choose the type of Action you want to Track in Funnelytics.",
    "alwaysInSummary": false,
    "selectItems": [
      {
        "displayValue": "Purchase",
        "value": "__commerce_action__"
      },
      {
        "value": "Form Submit",
        "displayValue": "Form Submission"
      },
      {
        "value": "Video View",
        "displayValue": "Video View"
      },
      {
        "value": "Add to Cart",
        "displayValue": "Add to Cart"
      },
      {
        "value": "Link Click",
        "displayValue": "Link Click"
      },
      {
        "value": "Scroll",
        "displayValue": "Scroll"
      },
      {
        "value": "custom",
        "displayValue": "Custom"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "baseScript",
        "type": "EQUALS",
        "paramValue": "action"
      }
    ],
    "displayName": "Action To Track",
    "simpleValueType": true,
    "name": "actionType",
    "type": "SELECT",
    "subParams": [
      {
        "type": "TEXT",
        "name": "customActionName",
        "displayName": "Custom Action Name",
        "simpleValueType": true,
        "enablingConditions": [
          {
            "paramName": "actionType",
            "paramValue": "custom",
            "type": "EQUALS"
          }
        ],
        "valueValidators": [
          {
            "type": "NON_EMPTY"
          }
        ],
        "help": "Type the name of your Custom Action that you want to be displayed in the Funnelytics Canvas"
      }
    ],
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      }
    ]
  },
  {
    "type": "GROUP",
    "name": "attributes",
    "displayName": "Action Properties",
    "groupStyle": "ZIPPY_OPEN",
    "subParams": [
      {
        "type": "SIMPLE_TABLE",
        "name": "purchaseAttributes",
        "displayName": "Purchase Action Properties",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Name",
            "name": "name",
            "type": "SELECT",
            "selectItems": [
              {
                "value": "__sku__",
                "displayValue": "SKU"
              },
              {
                "value": "__label__",
                "displayValue": "Label"
              },
              {
                "value": "__total_in_cents__",
                "displayValue": "Total in cents"
              },
              {
                "value": "__order__",
                "displayValue": "Order Number"
              },
              {
                "value": "name",
                "displayValue": "Name"
              },
              {
                "value": "email",
                "displayValue": "Email"
              },
              {
                "value": "pagePath",
                "displayValue": "Page Path"
              }
            ],
            "isUnique": true
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT",
            "selectItems": []
          }
        ],
        "enablingConditions": [
          {
            "paramName": "actionType",
            "paramValue": "__commerce_action__",
            "type": "EQUALS"
          }
        ],
        "help": "The Properties usually used for a Purchase action are \u003cstrong\u003eSKU\u003c/strong\u003e, \u003cstrong\u003eLabel\u003c/strong\u003e, \u003cstrong\u003eTotal in cents\u003c/strong\u003e, \u003cstrong\u003eOrder Number\u003c/strong\u003e, \u003cstrong\u003eName\u003c/strong\u003e, \u003cstrong\u003eEmail\u003c/strong\u003e, and \u003cstrong\u003ePAGE PATH\u003c/strong\u003e.   The SKU, Label, Total in Cents, and Order Number will report the info about the product purchased, while Name and Email will report info about the buyer and the Page Path the page where the Purchase action occurred.                                                                                                                 \u003cstrong\u003eNOTE: Total in cents\u003c/strong\u003e must be a value \u003cunderline\u003ein cents\u003cunderline\u003e for the purchase (or a variable that holds that same value). Examples of correct values are 500 for 5(five),  4900 for 49(fortynine), and so on.",
        "newRowButtonText": "Add Purchase Action Property"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "formSubmitAttributes",
        "displayName": "Form Submission Action Properties",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Name",
            "name": "name",
            "type": "SELECT",
            "selectItems": [
              {
                "value": "name",
                "displayValue": "Name"
              },
              {
                "value": "email",
                "displayValue": "Email"
              },
              {
                "value": "pagePath",
                "displayValue": "Page Path"
              }
            ],
            "isUnique": true
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT",
            "selectItems": []
          }
        ],
        "enablingConditions": [
          {
            "paramName": "actionType",
            "paramValue": "Form Submit",
            "type": "EQUALS"
          }
        ],
        "help": "The Properties usually used for a Form Submission action are  \u003cstrong\u003eName\u003c/strong\u003e, \u003cstrong\u003eEmail\u003c/strong\u003e, and \u003cstrong\u003ePAGE PATH\u003c/strong\u003e.   The Name and Email will report info about the user and the Page Path the page where the Form Submission action occurred.                                                                                                                 \u003cstrong\u003eNOTE: \u003c/strong\u003eWe suggest tracking any drop-down or checkbox in a form to have all the possible \"stackable\" info to then be able to filter your audience in Funnelytics. Add any of those as custom attributes.",
        "newRowButtonText": "Add Form Submission Action Property"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "videoViewAttributes",
        "displayName": "Video View Action Properties",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Name",
            "name": "name",
            "type": "SELECT",
            "selectItems": [
              {
                "value": "videoName",
                "displayValue": "Video Name"
              },
              {
                "value": "videoAction",
                "displayValue": "Video Action"
              },
              {
                "value": "videoPlayer",
                "displayValue": "Video Player"
              },
              {
                "value": "pagePath",
                "displayValue": "Page Path"
              }
            ],
            "isUnique": true
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT",
            "selectItems": []
          }
        ],
        "enablingConditions": [
          {
            "paramName": "actionType",
            "paramValue": "Video View",
            "type": "EQUALS"
          }
        ],
        "help": "The Properties usually used for a scroll action are \u003cstrong\u003eVIDEO NAME\u003c/strong\u003e, \u003cstrong\u003eVIDEO ACTION\u003c/strong\u003e , \u003cstrong\u003eVIDEO PLAYER\u003c/strong\u003e  and \u003cstrong\u003ePAGE PATH\u003c/strong\u003e.   The Video Name will report the Name of the video file, the Video Action will report the interaction of the user (play, pause, 10% etc) with the video, the Video Player will report the name of the video Player, and the Page Path the page where the video action occurred.",
        "newRowButtonText": "Add Video View Action Property"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "addToCartAttributes",
        "displayName": "Add to Cart Action Properties",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Name",
            "name": "name",
            "type": "SELECT",
            "selectItems": [
              {
                "value": "productID",
                "displayValue": "Product ID"
              },
              {
                "value": "productName",
                "displayValue": "Product Name"
              },
              {
                "value": "price",
                "displayValue": "Price"
              },
              {
                "value": "quantity",
                "displayValue": "Quantity"
              },
              {
                "value": "category",
                "displayValue": "Category"
              },
              {
                "value": "pagePath",
                "displayValue": "Page Path"
              }
            ],
            "isUnique": true
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT",
            "selectItems": []
          }
        ],
        "enablingConditions": [
          {
            "paramName": "actionType",
            "paramValue": "Add to Cart",
            "type": "EQUALS"
          }
        ],
        "help": "The Properties usually used for a Purchase action are \u003cstrong\u003ePRODUCT ID\u003c/strong\u003e, \u003cstrong\u003ePRODUCT NAME\u003c/strong\u003e, \u003cstrong\u003ePRICE\u003c/strong\u003e, \u003cstrong\u003eCATEGORY\u003c/strong\u003e, and \u003cstrong\u003ePAGE PATH\u003c/strong\u003e.   The Product ID, Product Name, Price, and Category will report the info about the product added to the cart, while the Page Path the page where the Add to Cart action occurred.",
        "newRowButtonText": "Add Add to Cart Action Property"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "linkClickAttributes",
        "displayName": "Link Click Action Properties",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Name",
            "name": "name",
            "type": "SELECT",
            "selectItems": [
              {
                "value": "clickText",
                "displayValue": "Click Text"
              },
              {
                "value": "clickURL",
                "displayValue": "Click URL"
              },
              {
                "value": "pagePath",
                "displayValue": "Page Path"
              }
            ],
            "isUnique": true
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT",
            "selectItems": []
          }
        ],
        "enablingConditions": [
          {
            "paramName": "actionType",
            "paramValue": "Link Click",
            "type": "EQUALS"
          }
        ],
        "help": "The Properties usually used for a link click action are \u003cstrong\u003eClick URL\u003c/strong\u003e, \u003cstrong\u003eClick Text\u003c/strong\u003e and \u003cstrong\u003ePAGE PATH\u003c/strong\u003e.   The Click URL will report the link that was clicked on, the Click Text will report the text that was used for the link (ex. Click Here, Continue, etc) and the Page Path the page where the link click action occurred.",
        "newRowButtonText": "Add Link Click Action Property"
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "scrollAttributes",
        "displayName": "Scroll Action Properties",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Name",
            "name": "name",
            "type": "SELECT",
            "selectItems": [
              {
                "value": "scroll",
                "displayValue": "Scroll"
              },
              {
                "value": "pagePath",
                "displayValue": "Page Path"
              }
            ],
            "isUnique": true
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT",
            "selectItems": []
          }
        ],
        "enablingConditions": [
          {
            "paramName": "actionType",
            "paramValue": "Scroll",
            "type": "EQUALS"
          }
        ],
        "newRowButtonText": "Add Scroll Action Property",
        "help": "The Properties usually used for a scroll action are \u003cstrong\u003eSCROLL\u003c/strong\u003e and \u003cstrong\u003ePAGE PATH\u003c/strong\u003e. \n\nThe Scroll will report the Percentage of Page scrolled (aka Scroll Threshold) and the Page Path the page where the Scroll action occurred."
      },
      {
        "type": "SIMPLE_TABLE",
        "name": "customAttributes",
        "displayName": "Custom Properties",
        "simpleTableColumns": [
          {
            "defaultValue": "",
            "displayName": "Name",
            "name": "name",
            "type": "TEXT"
          },
          {
            "defaultValue": "",
            "displayName": "Value",
            "name": "value",
            "type": "TEXT"
          }
        ],
        "newRowButtonText": "Add Custom Property",
        "help": "Add custom properties to your action"
      }
    ],
    "enablingConditions": [
      {
        "paramName": "baseScript",
        "paramValue": "action",
        "type": "EQUALS"
      }
    ]
  },
  {
    "type": "CHECKBOX",
    "name": "waitFunction",
    "checkboxText": "[BETA] Add a waiting function to the action script (useful for actions fired on the page load or soon after that)",
    "simpleValueType": true,
    "enablingConditions": [
      {
        "paramName": "baseScript",
        "paramValue": "action",
        "type": "EQUALS"
      }
    ],
    "displayName": "Funnelytics Base Script waiting Function",
    "alwaysInSummary": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

const callInWindow = require('callInWindow');
const copyFromWindow = require('copyFromWindow');
const injectScript = require('injectScript');
const makeTableMap = require('makeTableMap');
const log = require('logToConsole');
const createQueue = require('createQueue');
const dataLayerPush = createQueue('dataLayer');
const callLater = require('callLater');

//Funnelytics variables declaration
const projectId = data.projectId;
const funnelytics = copyFromWindow('funnelytics'); 

//Initialize funnelytics and trigger gtmOnSuccess callback
const funnelyticsInit = () => {
    callInWindow('funnelytics.init', projectId, false);	
  return data.gtmOnSuccess();
};



//Track Funnelytics action
const trackAction = () => {
    let attributes =   data.purchaseAttributes ||  data.scrollAttributes ||  data.linkClickAttributes ||  data.formSubmitAttributes || data.videoViewAttributes || '';  
    let customAttributes = data.customAttributes || '';
    if (customAttributes === ''){
    }else if(attributes === ''){
    attributes = customAttributes;
    }else{
    let attribJoin = attributes.concat(customAttributes);
    attributes = attribJoin;
    }
	const props = attributes ? makeTableMap(attributes, 'name', 'value') : {};
  	const action = data.actionType === 'custom' ? data.customActionName : data.actionType;
	callInWindow('funnelytics.events.trigger', action, props, function(){});
  	return data.gtmOnSuccess();
  
};


//Track Funnelytics Action with Wait Function
var flWaitLine = [];

function trackActionWait () {

  if (copyFromWindow('funnelytics.step') && flWaitLine.length < 2500){
   trackAction();
   flWaitLine.length = 0;
  }
  else if(flWaitLine.length >= 2500){
   flDropEvent();
  }
  else { 
  flNOTDefined();
  }

}

function flDropEvent(){
	dataLayerPush(
      {'event': 'funnelyticsEventFailure',
        'tofix': {
        	'error': 'Funnelytics does not seem to be running correctly and accepting your event tag. To avoid an infinite loop the even has been dropped.',
          	'nextSteps': 'Check your Funnelytics Base Script installation and your event tags' 
      
      }});
return;
}  
  
function flNOTDefined(){
  flWaitLine.push('X');
  callLater(trackActionWait); 
  return ;   
}

//Check if base script was chosen and the window.funnelytics object exists yet.
if (data.baseScript === 'baseScript' && !funnelytics){
    const url = 'https://cdn.funnelytics.io/track-v3.js';
	injectScript(url, funnelyticsInit, data.gtmOnFailure, url);
}

else if (data.baseScript === 'baseScript' && funnelytics){
    	dataLayerPush({
      	'event': 'funnelyticsFailure',
        'tofix': {
        	'error': 'Funnelytics Base Script tag has not been executed',
          	'cause': 'Funnelytics is already running on this site',
          	'nextSteps': 'Remove previous Funnelytics installations to properly run this tag' 
        }
      });
}

else if (data.baseScript === 'action' && data.waitFunction){
 trackActionWait();
} 

else {
	trackAction();
}


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "inject_script",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://cdn.funnelytics.io/track-v3.js"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "access_globals",
        "versionId": "1"
      },
      "param": [
        {
          "key": "keys",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "funnelytics.init"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "funnelytics.events.trigger"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "funnelytics"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "dataLayer"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  }
                ]
              },
              {
                "type": 3,
                "mapKey": [
                  {
                    "type": 1,
                    "string": "key"
                  },
                  {
                    "type": 1,
                    "string": "read"
                  },
                  {
                    "type": 1,
                    "string": "write"
                  },
                  {
                    "type": 1,
                    "string": "execute"
                  }
                ],
                "mapValue": [
                  {
                    "type": 1,
                    "string": "funnelytics.step"
                  },
                  {
                    "type": 8,
                    "boolean": true
                  },
                  {
                    "type": 8,
                    "boolean": false
                  },
                  {
                    "type": 8,
                    "boolean": true
                  }
                ]
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  }
]


___TESTS___

scenarios:
- name: Untitled test 1
  code: |-
    const mockData = {
      // Mocked field values
    };

    // Call runCode to run the template's code.
    runCode(mockData);

    // Verify that the tag finished successfully.
    assertApi('gtmOnSuccess').wasCalled();


___NOTES___

Created on 6/12/2019, 4:58:30 PM


